/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ðŸ” Session Utils - ì±—ë´‡ ì„¸ì…˜ ë° ëŒ€í™” ì´ë ¥ ê´€ë¦¬ ìœ í‹¸ë¦¬í‹°
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * ì£¼ìš” ê¸°ëŠ¥:
 * - UUID ê¸°ë°˜ ê³ ìœ  ì„¸ì…˜ ID ìƒì„± ë° ê´€ë¦¬
 * - 24ì‹œê°„ ìžë™ ë§Œë£Œë˜ëŠ” ì„¸ì…˜ ë¼ì´í”„ì‚¬ì´í´ ê´€ë¦¬
 * - ëŒ€í™” ë©”ì‹œì§€ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì˜ì†ì„± ë³´ìž¥
 * - ì±—ë´‡ ë°©ë¬¸ ìƒíƒœ ì¶”ì  ë° ì´ë ¥ í‘œì‹œ ì œì–´
 * - ë©€í‹° ì„¸ì…˜ ì§€ì› (ì„¸ì…˜ë³„ ë…ë¦½ì ì¸ ë©”ì‹œì§€ ì €ìž¥)
 * 
 * ë³´ì•ˆ ê³ ë ¤ì‚¬í•­:
 * - localStorage ì‚¬ìš©ìœ¼ë¡œ ë„ë©”ì¸ë³„ ê²©ë¦¬
 * - ìžë™ ë§Œë£Œë¥¼ í†µí•œ ì„¸ì…˜ í•˜ì´ìž¬í‚¹ ë°©ì§€
 * - ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í†µí•œ graceful degradation
 * 
 * ë°ì´í„° êµ¬ì¡°:
 * - Session ID: UUID v4 í˜•ì‹ì˜ ê³ ìœ  ì‹ë³„ìž
 * - Timestamp: ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ (ì„¸ì…˜ ì—°ìž¥ìš©)
 * - Messages: ì„¸ì…˜ë³„ ëŒ€í™” ë©”ì‹œì§€ ë°°ì—´
 * - State: ë°©ë¬¸ ìƒíƒœ ë° ì´ë ¥ í‘œì‹œ ì„¤ì •
 */

import { v4 as uuidv4 } from 'uuid';

/**
 * ðŸ”‘ ì„¸ì…˜ ê´€ë¦¬ ìƒìˆ˜ ì •ì˜
 * localStorageì—ì„œ ì‚¬ìš©ë˜ëŠ” í‚¤ ì´ë¦„ë“¤ê³¼ ë§Œë£Œ ì‹œê°„ ì„¤ì •
 */
const SESSION_STORAGE_KEY = 'chatbot_session_id';        // ì„¸ì…˜ ID ì €ìž¥ í‚¤
const SESSION_TIMESTAMP_KEY = 'chatbot_session_timestamp'; // ì„¸ì…˜ íƒ€ìž„ìŠ¤íƒ¬í”„ í‚¤
const SESSION_MESSAGES_KEY = 'chatbot_session_messages';   // ëŒ€í™” ë©”ì‹œì§€ ì €ìž¥ í‚¤
const SESSION_STATE_KEY = 'chatbot_session_state';        // ì„¸ì…˜ ìƒíƒœ ì €ìž¥ í‚¤
const SESSION_EXPIRY_HOURS = 24; // 24ì‹œê°„ í›„ ì„¸ì…˜ ìžë™ ë§Œë£Œ

/**
 * ðŸ“± ì„¸ì…˜ ìƒíƒœ ì¸í„°íŽ˜ì´ìŠ¤
 * ì±—ë´‡ ë°©ë¬¸ ìƒíƒœì™€ ì´ë ¥ í‘œì‹œ ì„¤ì •ì„ ê´€ë¦¬í•˜ëŠ” ë°ì´í„° êµ¬ì¡°
 */
interface SessionState {
  wasInChatbot: boolean;      // ì´ì „ì— ì±—ë´‡ íŽ˜ì´ì§€ë¥¼ ë°©ë¬¸í–ˆëŠ”ì§€ ì—¬ë¶€
  lastVisitTime: number;      // ë§ˆì§€ë§‰ ë°©ë¬¸ ì‹œê°„ (ë°€ë¦¬ì´ˆ íƒ€ìž„ìŠ¤íƒ¬í”„)
  shouldShowHistory: boolean; // ëŒ€í™” ì´ë ¥ì„ í‘œì‹œí•´ì•¼ í•˜ëŠ”ì§€ ì—¬ë¶€
}

/**
 * ðŸ†” ìƒˆë¡œìš´ ì„¸ì…˜ ID ìƒì„± í•¨ìˆ˜
 * 
 * UUID v4 ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ì—¬ ê³ ìœ í•œ ì„¸ì…˜ ì‹ë³„ìžë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
 * ìƒì„±ëœ IDëŠ” ì•”í˜¸í•™ì ìœ¼ë¡œ ì•ˆì „í•˜ë©° ì¶©ëŒ ê°€ëŠ¥ì„±ì´ ê·¹ížˆ ë‚®ìŠµë‹ˆë‹¤.
 * 
 * @returns UUID v4 í˜•ì‹ì˜ ì„¸ì…˜ ID ë¬¸ìžì—´ (ì˜ˆ: "f47ac10b-58cc-4372-a567-0e02b2c3d479")
 */
export const generateSessionId = (): string => {
  return uuidv4();
};

/**
 * â° ì„¸ì…˜ ë§Œë£Œ ì—¬ë¶€ í™•ì¸ í•¨ìˆ˜
 * 
 * ì €ìž¥ëœ íƒ€ìž„ìŠ¤íƒ¬í”„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í˜„ìž¬ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
 * 24ì‹œê°„(SESSION_EXPIRY_HOURS)ì´ ì§€ë‚˜ë©´ ì„¸ì…˜ì„ ë§Œë£Œëœ ê²ƒìœ¼ë¡œ íŒë‹¨í•©ë‹ˆë‹¤.
 * 
 * ë§Œë£Œ ì¡°ê±´:
 * - íƒ€ìž„ìŠ¤íƒ¬í”„ê°€ ì—†ëŠ” ê²½ìš°
 * - í˜„ìž¬ ì‹œê°„ê³¼ ì €ìž¥ëœ ì‹œê°„ì˜ ì°¨ì´ê°€ 24ì‹œê°„ì„ ì´ˆê³¼í•˜ëŠ” ê²½ìš°
 * - localStorage ì ‘ê·¼ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°
 * 
 * @returns true: ì„¸ì…˜ ë§Œë£Œë¨, false: ì„¸ì…˜ ìœ íš¨í•¨
 */
const isSessionExpired = (): boolean => {
  try {
    // ì €ìž¥ëœ íƒ€ìž„ìŠ¤íƒ¬í”„ ì¡°íšŒ
    const timestampStr = localStorage.getItem(SESSION_TIMESTAMP_KEY);
    if (!timestampStr) return true;
    
    // íƒ€ìž„ìŠ¤íƒ¬í”„ íŒŒì‹± ë° ë§Œë£Œ ì‹œê°„ ê³„ì‚°
    const timestamp = parseInt(timestampStr, 10);
    const now = Date.now();
    const expiryTime = SESSION_EXPIRY_HOURS * 60 * 60 * 1000; // 24ì‹œê°„ì„ ë°€ë¦¬ì´ˆë¡œ ë³€í™˜
    
    // í˜„ìž¬ ì‹œê°„ê³¼ ì €ìž¥ëœ ì‹œê°„ì˜ ì°¨ì´ê°€ ë§Œë£Œ ì‹œê°„ì„ ì´ˆê³¼í•˜ëŠ”ì§€ í™•ì¸
    return (now - timestamp) > expiryTime;
  } catch (error) {
    console.warn('ì„¸ì…˜ ë§Œë£Œ í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
    return true; // ì—ëŸ¬ ë°œìƒ ì‹œ ì•ˆì „í•˜ê²Œ ë§Œë£Œëœ ê²ƒìœ¼ë¡œ ì²˜ë¦¬
  }
};

/**
 * ðŸ• ì„¸ì…˜ íƒ€ìž„ìŠ¤íƒ¬í”„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
 * 
 * í˜„ìž¬ ì‹œê°„ì„ localStorageì— ì €ìž¥í•˜ì—¬ ì„¸ì…˜ì˜ ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ì„ ê°±ì‹ í•©ë‹ˆë‹¤.
 * ì´ í•¨ìˆ˜ëŠ” ì‚¬ìš©ìžê°€ ì„¸ì…˜ê³¼ ìƒí˜¸ìž‘ìš©í•  ë•Œë§ˆë‹¤ í˜¸ì¶œë˜ì–´ ì„¸ì…˜ ë§Œë£Œë¥¼ ì—°ìž¥ì‹œí‚µë‹ˆë‹¤.
 * 
 * ë™ìž‘ ê³¼ì •:
 * 1. í˜„ìž¬ ì‹œê°„ì„ ë°€ë¦¬ì´ˆ ë‹¨ìœ„ë¡œ íšë“
 * 2. ë¬¸ìžì—´ë¡œ ë³€í™˜í•˜ì—¬ localStorageì— ì €ìž¥
 * 3. ì €ìž¥ ì‹¤íŒ¨ ì‹œ ê²½ê³  ë¡œê·¸ ì¶œë ¥ (ê¸°ëŠ¥ì—ëŠ” ì˜í–¥ ì—†ìŒ)
 * 
 * ìš©ë„:
 * - ì„¸ì…˜ í™œë™ ì‹œê°„ ì¶”ì 
 * - ìžë™ ì„¸ì…˜ ì—°ìž¥ ë©”ì»¤ë‹ˆì¦˜
 * - ì„¸ì…˜ ë§Œë£Œ ì‹œê°„ ê³„ì‚°ì˜ ê¸°ì¤€ì  ì œê³µ
 * 
 * @internal ë‚´ë¶€ í•¨ìˆ˜ë¡œ, ì§ì ‘ í˜¸ì¶œí•˜ì§€ ë§ê³  ë‹¤ë¥¸ ì„¸ì…˜ í•¨ìˆ˜ë¥¼ í†µí•´ ìžë™ í˜¸ì¶œë¨
 */
const updateSessionTimestamp = (): void => {
  try {
    localStorage.setItem(SESSION_TIMESTAMP_KEY, Date.now().toString());
  } catch (error) {
    console.warn('Failed to update session timestamp:', error);
  }
};

/**
 * ðŸ” í˜„ìž¬ ì„¸ì…˜ ID ì¡°íšŒ ë° ìžë™ ìƒì„± í•¨ìˆ˜
 * 
 * ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í•µì‹¬ ì„¸ì…˜ ê´€ë¦¬ í•¨ìˆ˜ë¡œ, ì‚¬ìš©ìžë³„ ê³ ìœ  ì„¸ì…˜ì„ ë³´ìž¥í•©ë‹ˆë‹¤.
 * ê¸°ì¡´ ìœ íš¨í•œ ì„¸ì…˜ì´ ìžˆìœ¼ë©´ ìž¬ì‚¬ìš©í•˜ê³ , ì—†ê±°ë‚˜ ë§Œë£Œë˜ì—ˆìœ¼ë©´ ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤.
 * 
 * ðŸ“‹ ë™ìž‘ ë¡œì§:
 * 1. localStorageì—ì„œ ê¸°ì¡´ ì„¸ì…˜ ID ê²€ìƒ‰
 * 2. ì„¸ì…˜ì´ ì¡´ìž¬í•˜ê³  ìœ íš¨í•œì§€ í™•ì¸ (ë§Œë£Œ ì‹œê°„ ì²´í¬)
 * 3. ìœ íš¨í•œ ì„¸ì…˜ì´ë©´ íƒ€ìž„ìŠ¤íƒ¬í”„ ê°±ì‹  í›„ ë°˜í™˜
 * 4. ì—†ê±°ë‚˜ ë§Œë£Œëœ ì„¸ì…˜ì´ë©´ ìƒˆ UUID ìƒì„± í›„ ì €ìž¥
 * 5. localStorage ì ‘ê·¼ ì‹¤íŒ¨ ì‹œ ìž„ì‹œ ì„¸ì…˜ ID ë°˜í™˜
 * 
 * ðŸ”„ ì„¸ì…˜ ë¼ì´í”„ì‚¬ì´í´:
 * - ìƒì„±: ì²« ë°©ë¬¸ ì‹œ ë˜ëŠ” ë§Œë£Œ í›„
 * - ì—°ìž¥: ì‚¬ìš©í•  ë•Œë§ˆë‹¤ 24ì‹œê°„ ì—°ìž¥
 * - ë§Œë£Œ: 24ì‹œê°„ ë¹„í™œì„± ìƒíƒœ ì‹œ ìžë™ ë§Œë£Œ
 * 
 * ðŸ›¡ï¸ ì—ëŸ¬ ì²˜ë¦¬:
 * - localStorage ë¹„í™œì„±í™”/ì˜¤ë¥˜ ì‹œ ìž„ì‹œ ì„¸ì…˜ ì œê³µ
 * - ë¬´íš¨í•œ ì„¸ì…˜ IDëŠ” ìžë™ìœ¼ë¡œ ìƒˆë¡œ ìƒì„±
 * - graceful degradationìœ¼ë¡œ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ë°©ì§€
 * 
 * @returns ìœ íš¨í•œ ì„¸ì…˜ ID ë¬¸ìžì—´ (UUID v4 í˜•ì‹)
 * @public ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ê³µê°œ í•¨ìˆ˜
 */
export const getSessionId = (): string => {
  try {
    // localStorageì—ì„œ ê¸°ì¡´ ì„¸ì…˜ ID ì¡°íšŒ
    const existingSessionId = localStorage.getItem(SESSION_STORAGE_KEY);
    
    // ì„¸ì…˜ì´ ìžˆê³  ë§Œë£Œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ê¸°ì¡´ ì„¸ì…˜ ì‚¬ìš©
    if (existingSessionId && existingSessionId.trim() && !isSessionExpired()) {
      // ì„¸ì…˜ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ íƒ€ìž„ìŠ¤íƒ¬í”„ ê°±ì‹  (ì„¸ì…˜ ì—°ìž¥)
      updateSessionTimestamp();
      return existingSessionId;
    }
    
    // ê¸°ì¡´ ì„¸ì…˜ì´ ì—†ê±°ë‚˜ ë§Œë£Œë˜ì—ˆìœ¼ë©´ ìƒˆë¡œ ìƒì„±
    const newSessionId = generateSessionId();
    localStorage.setItem(SESSION_STORAGE_KEY, newSessionId);
    updateSessionTimestamp();
    
    return newSessionId;
  } catch (error) {
    // localStorage ì ‘ê·¼ ì‹¤íŒ¨ ì‹œ ìž„ì‹œ ì„¸ì…˜ ID ìƒì„± (ì €ìž¥ë˜ì§€ ì•ŠìŒ)
    console.warn('Failed to access localStorage for session ID:', error);
    return generateSessionId();
  }
};

/**
 * ðŸ—‘ï¸ ì „ì²´ ì„¸ì…˜ ë°ì´í„° ì‚­ì œ í•¨ìˆ˜
 * 
 * ì‚¬ìš©ìž ë¡œê·¸ì•„ì›ƒ, ì„¸ì…˜ ì´ˆê¸°í™”, ê°œì¸ì •ë³´ ë³´í˜¸ ë“±ì˜ ëª©ì ìœ¼ë¡œ
 * localStorageì— ì €ìž¥ëœ ëª¨ë“  ì„¸ì…˜ ê´€ë ¨ ë°ì´í„°ë¥¼ ì™„ì „ížˆ ì œê±°í•©ë‹ˆë‹¤.
 * 
 * ðŸ§¹ ì‚­ì œë˜ëŠ” ë°ì´í„°:
 * - ì„¸ì…˜ ID (SESSION_STORAGE_KEY)
 * - ì„¸ì…˜ íƒ€ìž„ìŠ¤íƒ¬í”„ (SESSION_TIMESTAMP_KEY) 
 * - ëŒ€í™” ë©”ì‹œì§€ ë‚´ì—­ (SESSION_MESSAGES_KEY)
 * - ì„¸ì…˜ ìƒíƒœ ì •ë³´ (SESSION_STATE_KEY)
 * 
 * ðŸ“ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:
 * - ì‚¬ìš©ìž ëª…ì‹œì  ë¡œê·¸ì•„ì›ƒ
 * - ë³´ì•ˆìƒ ì„¸ì…˜ ë¬´íš¨í™” í•„ìš” ì‹œ
 * - ì• í”Œë¦¬ì¼€ì´ì…˜ ìž¬ì‹œìž‘/ì´ˆê¸°í™”
 * - ê°œì¸ì •ë³´ ì‚­ì œ ìš”ì²­ ì²˜ë¦¬
 * 
 * âš ï¸ ì£¼ì˜ì‚¬í•­:
 * - ì´ í•¨ìˆ˜ í˜¸ì¶œ í›„ ëª¨ë“  ì„¸ì…˜ ë°ì´í„°ê°€ ì˜êµ¬ ì‚­ì œë¨
 * - ëŒ€í™” ë‚´ì—­ ë° ìƒíƒœ ì •ë³´ë„ í•¨ê»˜ ì‚­ì œë¨
 * - ë‹¤ìŒ ì ‘ê·¼ ì‹œ ìƒˆë¡œìš´ ì„¸ì…˜ì´ ìžë™ ìƒì„±ë¨
 * 
 * @public ë¡œê·¸ì•„ì›ƒ ë° ì„¸ì…˜ ì´ˆê¸°í™” ì‹œ ì‚¬ìš©
 */
export const clearSessionId = (): void => {
  try {
    localStorage.removeItem(SESSION_STORAGE_KEY);
    localStorage.removeItem(SESSION_TIMESTAMP_KEY);
    localStorage.removeItem(SESSION_MESSAGES_KEY);
    localStorage.removeItem(SESSION_STATE_KEY);
  } catch (error) {
    console.warn('Failed to clear session ID from localStorage:', error);
  }
};

/**
 * ðŸ”§ íŠ¹ì • ì„¸ì…˜ ID ê°•ì œ ì„¤ì • í•¨ìˆ˜
 * 
 * ê°œë°œ, í…ŒìŠ¤íŠ¸, ë””ë²„ê¹… ëª©ì ìœ¼ë¡œ íŠ¹ì • ì„¸ì…˜ IDë¥¼ ì§ì ‘ ì„¤ì •í•©ë‹ˆë‹¤.
 * ì¼ë°˜ì ì¸ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©°, ì£¼ë¡œ ê°œë°œ ë„êµ¬ë¡œ í™œìš©ë©ë‹ˆë‹¤.
 * 
 * ðŸŽ¯ ì£¼ìš” ìš©ë„:
 * - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì—ì„œ ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì„¸ì…˜ ID ì„¤ì •
 * - ê°œë°œ ì¤‘ íŠ¹ì • ì„¸ì…˜ ìƒíƒœ ìž¬í˜„
 * - QA í…ŒìŠ¤íŠ¸ì—ì„œ ì‹œë‚˜ë¦¬ì˜¤ë³„ ì„¸ì…˜ ê´€ë¦¬
 * - ë””ë²„ê¹… ì‹œ ì„¸ì…˜ ì¶”ì  ìš©ì´ì„± í™•ë³´
 * 
 * ðŸ“‹ ë™ìž‘ ê³¼ì •:
 * 1. ìž…ë ¥ëœ ì„¸ì…˜ ID ìœ íš¨ì„± ê²€ì¦ (ë¹ˆ ë¬¸ìžì—´ ì²´í¬)
 * 2. localStorageì— ì„¸ì…˜ ID ì €ìž¥
 * 3. í˜„ìž¬ ì‹œê°„ìœ¼ë¡œ íƒ€ìž„ìŠ¤íƒ¬í”„ ê°±ì‹ 
 * 4. ì˜¤ë¥˜ ë°œìƒ ì‹œ ê²½ê³  ë¡œê·¸ ì¶œë ¥
 * 
 * âš ï¸ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­:
 * - ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì‚¬ìš© ê¸ˆì§€
 * - ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì„¸ì…˜ ID ì‚¬ìš© ì‹œ ë³´ì•ˆ ìœ„í—˜ ì¡´ìž¬
 * - í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ ì¼ë°˜ ì„¸ì…˜ìœ¼ë¡œ ë³µêµ¬ ê¶Œìž¥
 * 
 * @param sessionId ì„¤ì •í•  ì„¸ì…˜ ID (ë¹ˆ ë¬¸ìžì—´ ë¶ˆê°€)
 * @throws Error ë¹ˆ ì„¸ì…˜ ID ìž…ë ¥ ì‹œ ì—ëŸ¬ ë°œìƒ
 * @public í…ŒìŠ¤íŠ¸ ë° ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©
 */
export const setSessionId = (sessionId: string): void => {
  try {
    if (!sessionId || !sessionId.trim()) {
      throw new Error('Session ID cannot be empty');
    }
    localStorage.setItem(SESSION_STORAGE_KEY, sessionId);
    updateSessionTimestamp();
  } catch (error) {
    console.warn('Failed to set session ID in localStorage:', error);
  }
};

/**
 * ðŸ”„ ì„¸ì…˜ í™œì„±í™” ë° ì—°ìž¥ í•¨ìˆ˜
 * 
 * ì‚¬ìš©ìžì˜ í™œë™ì„ ê°ì§€í•˜ê³  ì„¸ì…˜ ë§Œë£Œ ì‹œê°„ì„ ì—°ìž¥í•˜ëŠ” í•µì‹¬ í•¨ìˆ˜ìž…ë‹ˆë‹¤.
 * ëŒ€í™”, íŽ˜ì´ì§€ ì´ë™, ì‚¬ìš©ìž ìƒí˜¸ìž‘ìš© ì‹œë§ˆë‹¤ í˜¸ì¶œë˜ì–´ ì„¸ì…˜ì„ í™œì„± ìƒíƒœë¡œ ìœ ì§€í•©ë‹ˆë‹¤.
 * 
 * ðŸŽ¯ ì£¼ìš” ê¸°ëŠ¥:
 * - í˜„ìž¬ ì‹œê°„ìœ¼ë¡œ ì„¸ì…˜ íƒ€ìž„ìŠ¤íƒ¬í”„ ê°±ì‹ 
 * - 24ì‹œê°„ ë§Œë£Œ ì‹œê°„ì„ í˜„ìž¬ ì‹œì ë¶€í„° ìž¬ê³„ì‚°
 * - ì‚¬ìš©ìž í™œë™ ì¶”ì  ë° ì„¸ì…˜ ì§€ì†ì„± ë³´ìž¥
 * 
 * ðŸ“ž í˜¸ì¶œ ì‹œì :
 * - ì±—ë´‡ê³¼ ëŒ€í™”í•  ë•Œë§ˆë‹¤
 * - íŽ˜ì´ì§€ ê°„ ì´ë™ ì‹œ
 * - ì¤‘ìš”í•œ ì‚¬ìš©ìž ì•¡ì…˜ ìˆ˜í–‰ ì‹œ
 * - ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì£¼ê¸°ì  í˜¸ì¶œ (ì„ íƒì‚¬í•­)
 * 
 * ðŸ”— ì—°ê´€ í•¨ìˆ˜:
 * - updateSessionTimestamp(): ì‹¤ì œ íƒ€ìž„ìŠ¤íƒ¬í”„ ê°±ì‹  ë¡œì§
 * - isSessionExpired(): ë§Œë£Œ ì—¬ë¶€ íŒë‹¨ ì‹œ ê°±ì‹ ëœ ì‹œê°„ ì°¸ì¡°
 * - getSessionId(): ì„¸ì…˜ ì¡°íšŒ ì‹œ ìžë™ìœ¼ë¡œ í™œì„±í™” ìˆ˜í–‰
 * 
 * ðŸ’¡ ì‚¬ìš© ì˜ˆì‹œ:
 * ```typescript
 * // ëŒ€í™” ë©”ì‹œì§€ ì „ì†¡ ì‹œ
 * sendMessage(message);
 * refreshSession(); // ì„¸ì…˜ ì—°ìž¥
 * 
 * // íŽ˜ì´ì§€ ì´ë™ ì‹œ
 * router.navigate('/dashboard');
 * refreshSession(); // í™œë™ ì¶”ì 
 * ```
 * 
 * @public ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©ìž í™œë™ ì‹œ í˜¸ì¶œ
 */
export const refreshSession = (): void => {
  updateSessionTimestamp();
};

/**
 * ðŸ’¾ ëŒ€í™” ë©”ì‹œì§€ ì˜ì†ì  ì €ìž¥ í•¨ìˆ˜
 * 
 * í˜„ìž¬ ì„¸ì…˜ì˜ ëª¨ë“  ëŒ€í™” ë‚´ì—­ì„ localStorageì— ì•ˆì „í•˜ê²Œ ì €ìž¥í•©ë‹ˆë‹¤.
 * ì„¸ì…˜ IDë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê³ ìœ í•œ ì €ìž¥ í‚¤ë¥¼ ìƒì„±í•˜ì—¬ ë©€í‹° ì„¸ì…˜ ì§€ì›ì„ ë³´ìž¥í•©ë‹ˆë‹¤.
 * 
 * ðŸ“ ë°ì´í„° êµ¬ì¡°:
 * - ì €ìž¥ í‚¤: SESSION_MESSAGES_KEY + "_" + sessionId
 * - ë°ì´í„°: JSON ì§ë ¬í™”ëœ ë©”ì‹œì§€ ë°°ì—´
 * - í˜•ì‹: [{sender, message, timestamp, ...}, ...]
 * 
 * ðŸ”„ ë™ìž‘ ê³¼ì •:
 * 1. í˜„ìž¬ ì„¸ì…˜ ID ìžë™ íšë“
 * 2. ì„¸ì…˜ë³„ ê³ ìœ  ë©”ì‹œì§€ í‚¤ ìƒì„±
 * 3. ë©”ì‹œì§€ ë°°ì—´ì„ JSONìœ¼ë¡œ ì§ë ¬í™”
 * 4. localStorageì— ì•ˆì „í•˜ê²Œ ì €ìž¥
 * 
 * ðŸ› ì—ëŸ¬ ì²˜ë¦¬:
 * - localStorage ìš©ëŸ‰ ì´ˆê³¼ ì‹œ graceful degradation
 * - JSON ì§ë ¬í™” ì‹¤íŒ¨ ì‹œ ê²½ê³  ë¡œê·¸ ì¶œë ¥
 * - ë¹„ê³µê°œ ëª¨ë“œì—ì„œ localStorage ë¹„í™œì„±í™” ëŒ€ì‘
 * 
 * ðŸ“Š ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:
 * - ëŒ€í™” ì¤‘ ì£¼ê¸°ì  ìžë™ ì €ìž¥
 * - ìƒˆë¡œìš´ ë©”ì‹œì§€ ì¶”ê°€ ì‹œ ì „ì²´ ë‚´ì—­ ì—…ë°ì´íŠ¸
 * - íŽ˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì „ ë°ì´í„° ìœ ì§€
 * - ë¸Œë¼ìš°ì € ë¹„ì •ìƒ ì¢…ë£Œ ëŒ€ë¹„ ë°ì´í„° ë³´í˜¸
 * 
 * @param messages ì €ìž¥í•  ëŒ€í™” ë©”ì‹œì§€ ë°°ì—´ (any[] íƒ€ìž…ìœ¼ë¡œ ìœ ì—°í•œ ë©”ì‹œì§€ êµ¬ì¡° ì§€ì›)
 * @public ì±—ë´‡ ë° ëŒ€í™” ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©
 */
export const saveChatMessages = (messages: any[]): void => {
  try {
    const sessionId = getSessionId();
    const messagesKey = `${SESSION_MESSAGES_KEY}_${sessionId}`;
    localStorage.setItem(messagesKey, JSON.stringify(messages));
  } catch (error) {
    console.warn('Failed to save chat messages:', error);
  }
};

/**
 * ðŸ“¬ ëŒ€í™” ë©”ì‹œì§€ ë¡œë“œ ë° ë³µì› í•¨ìˆ˜
 * 
 * localStorageì— ì €ìž¥ëœ í˜„ìž¬ ì„¸ì…˜ì˜ ëŒ€í™” ë‚´ì—­ì„ ì•ˆì „í•˜ê²Œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
 * ì„¸ì…˜ë³„ë¡œ ë¶„ë¦¬ëœ ë©”ì‹œì§€ë¥¼ ì •í™•ížˆ ë¡œë“œí•˜ì—¬ ì¼ê´€ëœ ëŒ€í™” ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.
 * 
 * ðŸ” ë¡œë“œ ê³¼ì •:
 * 1. í˜„ìž¬ ì„¸ì…˜ ID ìžë™ íšë“
 * 2. ì„¸ì…˜ë³„ ë©”ì‹œì§€ í‚¤ ìƒì„±
 * 3. localStorageì—ì„œ ë°ì´í„° ì¡°íšŒ
 * 4. JSON ì—­ì§ë ¬í™”ë¥¼ í†µí•œ ê°ì²´ ë³µì›
 * 5. ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦
 * 
 * ðŸ›‘ ì˜ˆì™¸ ìƒí™© ì²˜ë¦¬:
 * - ì €ìž¥ëœ ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°: ë¹ˆ ë°°ì—´ ë°˜í™˜
 * - JSON íŒŒì‹± ì‹¤íŒ¨: ë¹ˆ ë°°ì—´ ë°˜í™˜ ë° ì˜¤ë¥˜ ë¡œê¹…
 * - localStorage ì ‘ê·¼ ì‹¤íŒ¨: ë¹ˆ ë°°ì—´ ë°˜í™˜
 * - ë°ì´í„° ì†ìƒ: graceful degradation
 * 
 * ðŸ“Š ë°ì´í„° ë¬´ê²°ì„±:
 * - ì„¸ì…˜ë³„ ì™„ì „ížˆ ë¶„ë¦¬ëœ ë°ì´í„°
 * - ë‹¤ë¥¸ ì„¸ì…˜ì˜ ë©”ì‹œì§€ì™€ í˜¼ìž¬ ë°©ì§€
 * - ë°ì´í„° í˜•ì‹ ìœ ì§€ ë° í˜¸í™˜ì„± ë³´ìž¥
 * 
 * ðŸš€ ì„±ëŠ¥ ìµœì í™”:
 * - localStorage ë‹¨ì¼ ì ‘ê·¼ìœ¼ë¡œ ë¹ ë¥¸ ë¡œë“œ
 * - ìºì‹œëœ ë°ì´í„° ì¦‰ì‹œ ë°˜í™˜
 * - ë¶ˆí•„ìš”í•œ ë°ì´í„° ë¡œë“œ ë°©ì§€
 * 
 * ðŸ“ ì‚¬ìš© ì˜ˆì‹œ:
 * ```typescript
 * // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ëŒ€í™” ë‚´ì—­ ë³µì›
 * const savedMessages = loadChatMessages();
 * setChatHistory(savedMessages);
 * 
 * // ëŒ€í™” ì§„í–‰ ì¤‘ ì´ì „ ë‚´ì—­ í™•ì¸
 * const previousChats = loadChatMessages();
 * ```
 * 
 * @returns ì €ìž¥ëœ ëŒ€í™” ë©”ì‹œì§€ ë°°ì—´ (ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´)
 * @public ì±—ë´‡ ë° ëŒ€í™” ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°ì´í„° ë³µì› ì‹œ ì‚¬ìš©
 */
export const loadChatMessages = (): any[] => {
  try {
    const sessionId = getSessionId();
    const messagesKey = `${SESSION_MESSAGES_KEY}_${sessionId}`;
    const savedMessages = localStorage.getItem(messagesKey);
    return savedMessages ? JSON.parse(savedMessages) : [];
  } catch (error) {
    console.warn('Failed to load chat messages:', error);
    return [];
  }
};

/**
 * ðŸ§¹ í˜„ìž¬ ì„¸ì…˜ ëŒ€í™” ë©”ì‹œì§€ ì „ì²´ ì‚­ì œ í•¨ìˆ˜
 * 
 * í˜„ìž¬ ì„¸ì…˜ì— ì €ìž¥ëœ ëª¨ë“  ëŒ€í™” ë‚´ì—­ì„ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤.
 * ë‹¤ë¥¸ ì„¸ì…˜ì˜ ëŒ€í™” ë‚´ì—­ì€ ë³´ì¡´ë˜ë©°, í˜„ìž¬ ì„¸ì…˜ë§Œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.
 * 
 * ðŸŽ¯ ì£¼ìš” ì‚¬ìš© ì‚¬ë¡€:
 * - ì‚¬ìš©ìžê°€ ëŒ€í™” ë‚´ì—­ ì‚­ì œ ìš”ì²­ ì‹œ
 * - ìƒˆë¡œìš´ ëŒ€í™” ì‹œìž‘ ì „ ì´ì „ ë‚´ì—­ ì •ë¦¬
 * - ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•œ ë°ì´í„° ì‚­ì œ
 * - ëŒ€í™” ìº„ë¦¬í‹° ë¬¸ì œ ì‹œ ë¦¬ì…‹
 * - í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ê¹¨ë—í•œ ìƒíƒœ ì¡°ì„±
 * 
 * ðŸ”’ ë°ì´í„° ì•ˆì „ì„±:
 * - ì„¸ì…˜ ID ê¸°ë°˜ ì •í™•í•œ íƒ€ê²ŸíŒ…
 * - ë‹¤ë¥¸ ì„¸ì…˜ ë°ì´í„° ë³´í˜¸
 * - localStorage ì•ˆì „ ì ‘ê·¼ ë° ì˜ˆì™¸ ì²˜ë¦¬
 * - ë°ì´í„° ë¬´ê²°ì„± ìœ ì§€
 * 
 * ðŸ”„ ì‚­ì œ ê³¼ì •:
 * 1. í˜„ìž¬ ì„¸ì…˜ ID ìžë™ íšë“
 * 2. ì„¸ì…˜ë³„ ë©”ì‹œì§€ í‚¤ ìƒì„±
 * 3. localStorageì—ì„œ í•´ë‹¹ í‚¤ ì‚­ì œ
 * 4. ì˜¤ë¥˜ ë°œìƒ ì‹œ ê²½ê³  ë¡œê·¸ ì¶œë ¥
 * 
 * âš ï¸ ì£¼ì˜ì‚¬í•­:
 * - ì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬ ë¶ˆê°€ëŠ¥
 * - ì‚¬ìš©ìž í™•ì¸ ì—†ì´ í˜¸ì¶œ ì‹œ ë°ì´í„° ì†ì‹¤ ìœ„í—˜
 * - ë‹¤ë¥¸ ì„¸ì…˜ì—ëŠ” ì˜í–¥ ì—†ìŒ
 * 
 * ðŸ’¡ ë² ìŠ¤íŠ¸ í”„ëž™í‹°ìŠ¤:
 * - ì‚¬ìš©ìž ì˜ë„ ëª…ì‹œì  í™•ì¸ í›„ í˜¸ì¶œ
 * - ì‚­ì œ ì „ ì¤‘ìš” ë°ì´í„° ë°±ì—… ê³ ë ¤
 * - ì‚­ì œ í›„ UI ìƒíƒœ ì—…ë°ì´íŠ¸
 * 
 * @public ì‚¬ìš©ìž ëŒ€í™” ë‚´ì—­ ê´€ë¦¬ ì—ì„œ ì‚¬ìš©
 */
export const clearChatMessages = (): void => {
  try {
    const sessionId = getSessionId();
    const messagesKey = `${SESSION_MESSAGES_KEY}_${sessionId}`;
    localStorage.removeItem(messagesKey);
  } catch (error) {
    console.warn('Failed to clear chat messages:', error);
  }
};

/**
 * ðŸ“ ì±—ë´‡ íŽ˜ì´ì§€ ë°©ë¬¸ ìƒíƒœ ì¶”ì  í•¨ìˆ˜
 * 
 * ì‚¬ìš©ìžê°€ ì±—ë´‡ íŽ˜ì´ì§€ë¥¼ ë°©ë¬¸í–ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ê¸°ë¡í•˜ê³  ìƒíƒœë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.
 * ì´ ì •ë³´ëŠ” ëŒ€í™” ë‚´ì—­ í‘œì‹œ, ë„¤ë¹„ê²Œì´ì…˜ ë™ìž‘, UI ìƒíƒœ ê²°ì •ì— í™œìš©ë©ë‹ˆë‹¤.
 * 
 * ðŸ“Š ì €ìž¥ë˜ëŠ” ìƒíƒœ ì •ë³´:
 * - wasInChatbot: ì±—ë´‡ ë°©ë¬¸ ì—¬ë¶€ (boolean)
 * - lastVisitTime: ë§ˆì§€ë§‰ ë°©ë¬¸ ì‹œê°„ (ë°€ë¦¬ì´ˆ íƒ€ìž„ìŠ¤íƒ¬í”„)
 * - shouldShowHistory: ëŒ€í™” ë‚´ì—­ í‘œì‹œ ì—¬ë¶€ (falseë¡œ ì´ˆê¸°í™”)
 * 
 * ðŸ”„ ìƒíƒœ ì´ˆê¸°í™” ë¡œì§:
 * - shouldShowHistoryëŠ” í•­ìƒ falseë¡œ ì„¤ì • (ë‹¤ë¥¸ í•¨ìˆ˜ì—ì„œ ì œì–´)
 * - lastVisitTimeì€ í˜„ìž¬ ì‹œê°„ìœ¼ë¡œ ìžë™ ì„¤ì •
 * - ì´ì „ ìƒíƒœëŠ” ì™„ì „ížˆ ëœì–´ì“°ê¸°ë¨
 * 
 * ðŸŽ¯ ì£¼ìš” ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:
 * - ì±—ë´‡ íŽ˜ì´ì§€ ì§„ìž… ì‹œ (wasInChatbot: true)
 * - ì±—ë´‡ íŽ˜ì´ì§€ ì´íƒˆ ì‹œ (wasInChatbot: false)
 * - íŽ˜ì´ì§€ ì „í™˜ ì¶”ì ì´ í•„ìš”í•œ ë„¤ë¹„ê²Œì´ì…˜
 * - ëŒ€í™” ë‚´ì—­ í‘œì‹œ ì—¬ë¶€ ê²°ì • ë¡œì§
 * 
 * ðŸ”— ì—°ê´€ í•¨ìˆ˜:
 * - getChatbotSessionState(): ì €ìž¥ëœ ìƒíƒœ ì¡°íšŒ
 * - setShouldShowHistory(): ë‚´ì—­ í‘œì‹œ ìƒíƒœ ê°œë³„ ì œì–´
 * - clearSessionState(): ìƒíƒœ ì „ì²´ ì´ˆê¸°í™”
 * 
 * ðŸ’¡ ì‚¬ìš© ì˜ˆì‹œ:
 * ```typescript
 * // ì±—ë´‡ íŽ˜ì´ì§€ ì§„ìž… ì‹œ
 * setChatbotVisitState(true);
 * 
 * // ë‹¤ë¥¸ íŽ˜ì´ì§€ë¡œ ì´ë™ ì‹œ
 * setChatbotVisitState(false);
 * ```
 * 
 * @param wasInChatbot ì±—ë´‡ íŽ˜ì´ì§€ ë°©ë¬¸ ì—¬ë¶€ (true: ë°©ë¬¸ ì¤‘, false: ì´íƒˆ)
 * @public ë„¤ë¹„ê²Œì´ì…˜ ë° ë¼ìš°íŒ… ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©
 */
export const setChatbotVisitState = (wasInChatbot: boolean): void => {
  try {
    const state: SessionState = {
      wasInChatbot,
      lastVisitTime: Date.now(),
      shouldShowHistory: false
    };
    localStorage.setItem(SESSION_STATE_KEY, JSON.stringify(state));
  } catch (error) {
    console.warn('Failed to save chatbot visit state:', error);
  }
};

/**
 * ðŸ“œ ëŒ€í™” ë‚´ì—­ í‘œì‹œ ìƒíƒœ ì œì–´ í•¨ìˆ˜
 * 
 * ì‚¬ìš©ìžì—ê²Œ ëŒ€í™” ë‚´ì—­ì„ ë³´ì—¬ì¤„ì§€ ì—¬ë¶€ë¥¼ ì„¸ë°€í•˜ê²Œ ì œì–´í•©ë‹ˆë‹¤.
 * ê¸°ì¡´ ì„¸ì…˜ ìƒíƒœë¥¼ ë³´ì¡´í•˜ë©´ì„œ shouldShowHistory ì†ì„±ë§Œ ì„ íƒì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
 * 
 * ðŸ”„ ì—…ë°ì´íŠ¸ ë¡œì§:
 * 1. ê¸°ì¡´ ì„¸ì…˜ ìƒíƒœ ì´ë²¤íŠ¸ ë³µì‚¬ (ë°ì´í„° ìœ ì§€)
 * 2. shouldShowHistory ì†ì„±ë§Œ ìƒˆë¡œìš´ ê°’ìœ¼ë¡œ ë³€ê²½
 * 3. lastVisitTimeì„ í˜„ìž¬ ì‹œê°„ìœ¼ë¡œ ê°±ì‹ 
 * 4. ì „ì²´ ìƒíƒœë¥¼ localStorageì— ì €ìž¥
 * 
 * ðŸŽ¯ ì£¼ìš” ì‚¬ìš© ì‚¬ë¡€:
 * - ì‚¬ìš©ìžê°€ ëŒ€í™” ë‚´ì—­ í‘œì‹œ/ìˆ¨ê¹€ í† ê¸€ ì¡°ìž‘
 * - ìƒˆë¡œìš´ ëŒ€í™” ì‹œìž‘ ì‹œ ë‚´ì—­ ìˆ¨ê¹€ ì²˜ë¦¬
 * - íŽ˜ì´ì§€ ìƒíƒœì— ë”°ë¥¸ ë‚´ì—­ í‘œì‹œ ì œì–´
 * - UI ì»´í¬ë„ŒíŠ¸ì˜ ì¡°ê±´ë¶€ ë Œë”ë§ ì œì–´
 * 
 * ðŸ”’ ë°ì´í„° ë¬´ê²°ì„±:
 * - spread operator ì‚¬ìš©ìœ¼ë¡œ ê¸°ì¡´ ë°ì´í„° ë³´ì „
 * - ì„ íƒì  ì—…ë°ì´íŠ¸ë¡œ ë°ì´í„° ì†ì‹¤ ë°©ì§€
 * - ìƒíƒœ ì¼ê´€ì„± ìœ ì§€ ë° ì˜ˆì¸¡ ê°€ëŠ¥ì„± í™•ë³´
 * 
 * ðŸ›¡ï¸ ì—ëŸ¬ ì²˜ë¦¬:
 * - getChatbotSessionState() ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’ ì‚¬ìš©
 * - localStorage ì ‘ê·¼ ì˜¤ë¥˜ ì‹œ graceful degradation
 * - JSON ì§ë ¬í™” ì‹¤íŒ¨ ì‹œ ê²½ê³  ë¡œê·¸ ì¶œë ¥
 * 
 * ðŸ’¡ ì‚¬ìš© ì˜ˆì‹œ:
 * ```typescript
 * // ëŒ€í™” ë‚´ì—­ ë³´ì´ê¸°
 * setShouldShowHistory(true);
 * 
 * // ëŒ€í™” ë‚´ì—­ ìˆ¨ê¸°ê¸°
 * setShouldShowHistory(false);
 * 
 * // ì‚¬ìš©ìž ì„¤ì •ì— ë”°ë¥¸ ë™ì  ì œì–´
 * setShouldShowHistory(userPreference.showHistory);
 * ```
 * 
 * @param shouldShow ëŒ€í™” ë‚´ì—­ í‘œì‹œ ì—¬ë¶€ (true: í‘œì‹œ, false: ìˆ¨ê¹€)
 * @public UI ì»´í¬ë„ŒíŠ¸ ë° ì‚¬ìš©ìž ì„¤ì •ì—ì„œ ì‚¬ìš©
 */
export const setShouldShowHistory = (shouldShow: boolean): void => {
  try {
    const existingState = getChatbotSessionState();
    const state: SessionState = {
      ...existingState,
      shouldShowHistory: shouldShow,
      lastVisitTime: Date.now()
    };
    localStorage.setItem(SESSION_STATE_KEY, JSON.stringify(state));
  } catch (error) {
    console.warn('Failed to set show history state:', error);
  }
};

/**
 * ðŸ—ºï¸ ì±—ë´‡ ì„¸ì…˜ ìƒíƒœ ì¡°íšŒ ë° ìžë™ ê´€ë¦¬ í•¨ìˆ˜
 * 
 * ì €ìž¥ëœ ì±—ë´‡ ì„¸ì…˜ ìƒíƒœë¥¼ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜¤ê³ , ì‹œê°„ ê¸°ë°˜ ìžë™ ë§Œë£Œ ë¡œì§ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
 * 5ë¶„ ì´ìƒ ë¹„í™œì„± ìƒíƒœì¼ ê²½ìš° ìžë™ìœ¼ë¡œ ìƒíƒœë¥¼ ì´ˆê¸°í™”í•˜ì—¬ ë°ì´í„° ì¼ê´€ì„±ì„ ë³´ìž¥í•©ë‹ˆë‹¤.
 * 
 * ðŸ•°ï¸ ìžë™ ë§Œë£Œ ë¡œì§ (5ë¶„ ê·œì¹™):
 * - 5ë¶„ ì´ë‚´: ì €ìž¥ëœ ìƒíƒœ ê·¸ëŒ€ë¡œ ë°˜í™˜
 * - 5ë¶„ ì´ˆê³¼: ìžë™ ì´ˆê¸°í™”ëœ ìƒíƒœ ë°˜í™˜
 *   - wasInChatbot: false (ì±—ë´‡ íŽ˜ì´ì§€ ì´íƒˆ ìƒíƒœ)
 *   - shouldShowHistory: true (ë‚´ì—­ í‘œì‹œ í—ˆìš©)
 *   - lastVisitTime: í˜„ìž¬ ì‹œê°„ìœ¼ë¡œ ê°±ì‹ 
 * 
 * ðŸ›€ ê¸°ë³¸ê°’ ì²˜ë¦¬:
 * ì €ìž¥ëœ ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ ì‹œ:
 * - wasInChatbot: false (ì´ˆê¸° ìƒíƒœ)
 * - lastVisitTime: í˜„ìž¬ ì‹œê°„
 * - shouldShowHistory: false (ì´ˆê¸°ì—ëŠ” ë‚´ì—­ ìˆ¨ê¹€)
 * 
 * ðŸ”„ ë™ìž‘ íë¦„:
 * 1. localStorageì—ì„œ ìƒíƒœ ë°ì´í„° ì¡°íšŒ
 * 2. JSON íŒŒì‹± ë° ë°ì´í„° ìœ íš¨ì„± ê²€ì¦
 * 3. ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ ê¸°ë°˜ ë§Œë£Œ ê²€ì‚¬
 * 4. ë§Œë£Œëœ ê²½ìš° ìžë™ ì´ˆê¸°í™”ëœ ìƒíƒœ ë°˜í™˜
 * 5. ìœ íš¨í•œ ê²½ìš° ì €ìž¥ëœ ìƒíƒœ ê·¸ëŒ€ë¡œ ë°˜í™˜
 * 
 * ðŸŽ¯ ì£¼ìš” ì‚¬ìš© ì‚¬ë¡€:
 * - ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ìƒíƒœ ë³µì›
 * - ë„¤ë¹„ê²Œì´ì…˜ ë¡œì§ì—ì„œ ì´ì „ ìƒíƒœ í™•ì¸
 * - ëŒ€í™” ë‚´ì—­ í‘œì‹œ ì—¬ë¶€ ê²°ì •
 * - UI ì¡°ê±´ë¶€ ë Œë”ë§ ì¡°ê±´ ì²´í¬
 * 
 * ðŸ“Š ì„±ëŠ¥ ìµœì í™”:
 * - ë‹¨ì¼ localStorage ì ‘ê·¼ìœ¼ë¡œ ë¹ ë¥¸ ë°ì´í„° ì¡°íšŒ
 * - ì¸ë©”ëª¨ë¦¬ ì—°ì‚°ìœ¼ë¡œ ë¹ ë¥¸ ë§Œë£Œ íŒë‹¨
 * - ë¶ˆí•„ìš”í•œ ë°ì´í„° ì§ë ¬í™” ì—†ì´ ê¸°ë³¸ê°’ ì œê³µ
 * 
 * ðŸ’¡ ì‚¬ìš© ì˜ˆì‹œ:
 * ```typescript
 * // UI ìƒíƒœ ê²°ì •
 * const state = getChatbotSessionState();
 * if (state.shouldShowHistory) {
 *   showChatHistory();
 * }
 * 
 * // ë„¤ë¹„ê²Œì´ì…˜ ë¡œì§
 * if (state.wasInChatbot) {
 *   continueChat();
 * } else {
 *   startNewConversation();
 * }
 * ```
 * 
 * @returns SessionState ê°ì²´ (í˜„ìž¬ ì„¸ì…˜ì˜ ëª¨ë“  ìƒíƒœ ì •ë³´)
 * @public ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ ìƒíƒœ ì¡°íšŒ ì‹œ ì‚¬ìš©
 */
export const getChatbotSessionState = (): SessionState => {
  try {
    const stateStr = localStorage.getItem(SESSION_STATE_KEY);
    if (stateStr) {
      const state = JSON.parse(stateStr);
      // 5ë¶„ ì´ìƒ ì§€ë‚¬ìœ¼ë©´ ìƒíƒœ ì´ˆê¸°í™”
      const fiveMinutes = 5 * 60 * 1000;
      if (Date.now() - state.lastVisitTime > fiveMinutes) {
        return {
          wasInChatbot: false,
          lastVisitTime: Date.now(),
          shouldShowHistory: true
        };
      }
      return state;
    }
  } catch (error) {
    console.warn('Failed to get chatbot session state:', error);
  }
  
  return {
    wasInChatbot: false,
    lastVisitTime: Date.now(),
    shouldShowHistory: false
  };
};

/**
 * ðŸ”„ ì„¸ì…˜ ìƒíƒœ ì™„ì „ ì´ˆê¸°í™” í•¨ìˆ˜
 * 
 * localStorageì— ì €ìž¥ëœ ëª¨ë“  ì„¸ì…˜ ìƒíƒœ ì •ë³´ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤.
 * ì´ í•¨ìˆ˜ í˜¸ì¶œ í›„ì—ëŠ” getChatbotSessionState()ê°€ ê¸°ë³¸ê°’ì„ ë°˜í™˜í•˜ê²Œ ë©ë‹ˆë‹¤.
 * 
 * ðŸ§¹ ì‚­ì œë˜ëŠ” ìƒíƒœ ë°ì´í„°:
 * - wasInChatbot: ì±—ë´‡ ë°©ë¬¸ ìƒíƒœ ì •ë³´
 * - lastVisitTime: ë§ˆì§€ë§‰ ë°©ë¬¸ ì‹œê°„ ë°ì´í„°
 * - shouldShowHistory: ëŒ€í™” ë‚´ì—­ í‘œì‹œ ì„¤ì •
 * 
 * ðŸŽ¯ ì£¼ìš” ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:
 * - ì‚¬ìš©ìž ë¡œê·¸ì•„ì›ƒ ì‹œ ì™„ì „í•œ ìƒíƒœ ì´ˆê¸°í™”
 * - ì• í”Œë¦¬ì¼€ì´ì…˜ ìž¬ì‹œìž‘ ì‹œ ê¹¨ë—í•œ ìƒíƒœ ì¡°ì„±
 * - ê°œì¸ì •ë³´ ì‚­ì œ ìš”ì²­ ì‹œ ìƒíƒœ ë°ì´í„° ì œê±°
 * - ë””ë²„ê¹… ëª©ì ìœ¼ë¡œ ì˜ˆì¸¡ ê°€ëŠ¥í•œ ìƒíƒœ ì¡°ì„±
 * - í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ê¸°ì¤€ ìƒíƒœ ë¦¬ì…‹
 * 
 * ðŸ”„ ì´ˆê¸°í™” í›„ ë™ìž‘:
 * - getChatbotSessionState() í˜¸ì¶œ ì‹œ ê¸°ë³¸ê°’ ë°˜í™˜:
 *   ```typescript
 *   {
 *     wasInChatbot: false,
 *     lastVisitTime: Date.now(),
 *     shouldShowHistory: false
 *   }
 *   ```
 * 
 * ðŸ”— ì—°ê´€ í•¨ìˆ˜ ì˜í–¥:
 * - setChatbotVisitState(): ë‹¤ìŒ í˜¸ì¶œì—ì„œ ìƒˆë¡œìš´ ìƒíƒœ ìƒì„±
 * - setShouldShowHistory(): ê¸°ë³¸ê°’ë¶€í„° ì‹œìž‘í•˜ì—¬ ì˜µì…˜ ì—…ë°ì´íŠ¸
 * - getChatbotSessionState(): ìƒíƒœ ì—†ìŒìœ¼ë¡œ ì¸ì‹í•˜ì—¬ ê¸°ë³¸ê°’ ìƒì„±
 * 
 * âš ï¸ ì£¼ì˜ì‚¬í•­:
 * - ì‚­ì œëœ ìƒíƒœëŠ” ë³µêµ¬ ë¶ˆê°€ëŠ¥í•¨
 * - UI ìƒíƒœê°€ ì˜ˆìƒê³¼ ë‹¤ë¥´ê²Œ ë™ìž‘í•  ìˆ˜ ìžˆìŒ
 * - ë‹¤ë¥¸ ì„¸ì…˜ ë°ì´í„°(ID, ë©”ì‹œì§€)ì—ëŠ” ì˜í–¥ ì—†ìŒ
 * 
 * ðŸ’ª ë² ìŠ¤íŠ¸ í”„ëž™í‹°ìŠ¤:
 * - ë¡œê·¸ì•„ì›ƒ í›„ ìƒíƒœ ì´ˆê¸°í™”ë¡œ ê¹¨ë—í•œ ìƒíƒœ ìœ ì§€
 * - ì´ˆê¸°í™” í›„ UI ì—…ë°ì´íŠ¸ë¡œ ì¼ê´€ì„± ë³´ìž¥
 * - ê°œë°œ í™˜ê²½ì—ì„œ ì˜ˆì¸¡ ê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì¡°ì„±
 * 
 * @public ì„¸ì…˜ ê´€ë¦¬ ë° ì¸ì¦ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©
 */
export const clearSessionState = (): void => {
  try {
    localStorage.removeItem(SESSION_STATE_KEY);
  } catch (error) {
    console.warn('Failed to clear session state:', error);
  }
};